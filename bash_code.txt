[llama.cpp 다운로드]
git clone https://github.com/ggml-org/llama.cpp.git



[환경설정]
# llama.cpp 폴더로 이동
cd llama.cpp
# llama.cpp의 readme처럼 build하기
cmake -B build
cmake --build build --config release
# build 중 혹시 에러 발생시
apt-get update
apt-get install -y libcurl4-openssl-dev pkg-config



[HuggingFace Hub 설치 및 로그인]
pip install huggingface_hub
huggingface-cli login



[llama-3.2-1B-Instruct 모델 다운로드]
cd ..
python llama_download.py



[llama 모델을 GGUF 형식으로 변환하기]
cd llama.cpp
python convert_hf_to_gguf.py ./../llama-3.2-1B-Instruct/ --outfile llama-3.2-1B-Instruct.gguf --outtype f16




[llama.cpp를 사용하여 inference]
./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p [원하는 문구] -n [최대토큰수]
./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p "llama.cpp는 뭐니?" -n 600
./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p "How can I learn to code?" -n 600



[KorQuAD 다운로드]
cd ..
python KorQuAD_v1_download.py



[Fine-Tuning 진행하기]
python llama_fine_tuning.py



[Fine-Tuning 하기 전과 후의 모델을 사용하여 Validation dataset에 대한 prediction 진행]
# fine-tuning 전 모델
python llama_predict.py --dev_json ./KorQuAD_v1.0/korquad_validation.json --model ./llama-3.2-1B-Instruct --out ./preds_base.json
# fine-tuning 후 모델
python llama_predict.py --dev_json ./KorQuAD_v1.0/korquad_validation.json --model ./merged-1B-instruct-ko --out ./preds_lora.json



[Fine-Tuning 하기 전 모델을 llama.cpp로 inference하여 validation dataset에 대한 결과 관찰하기]
cd llama.cpp

./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 하페즈 알아사드의 후계자 문제는 1998년 시리아 인민 의회 선거 이후 폭력적인 시위와 무력 충돌을 일으키며 1999년 라타키아 시위로 발전하였다. 이 사건은 하페즈 알아사드와 그의 동생 리파트 알아사드 사이에 몇 년 간 축적된 불화가 폭발한 사건이었다. 시리아 경찰은 라타키아의 리파트 항만 시설에 대한 단속을 벌였고, 이 과정에서 경찰과 리파트 알아사드 지지자들과의 총격전이 벌어져 2명이 살해되었다. 정부 측은 부정하고 있으나, 이 사건의 사상자가 수백명에 달했다는 추측이 있다. 하페즈 알아사드는 간질성 폐질환으로 1년 뒤 사망했으며, 하페즈 알아사드의 아들인 바샤르 알아사드가 대통령이 될 수 있는 나이 규정인 40세를 당시 그의 나이인 34세로 인하하도록 헌법을 수정한 후, 후계자가 되었다. 그의 아버지인 하페즈 알아사드를 이어 대통령이 된 바샤르 알아사드와 영국에서 태어나 교육을 받은 수니파 무슬림인 그의 아내 아스마 알아사드는 초기에는 민주주의를 실현하고 국가를 개혁하겠다는 희망을 시리아에 불어넣었다. 이 영향으로 2000년 7월부터 2001년 8월 사이 다마스쿠스의 봄이라는 강렬한 사회적, 정치적 논쟁이 시작된다. 이 기간에는 같은 생각을 가진 사람들끼리 모여 정치적, 사회적 문제에 대해 의논하는 살롱과 같은 다수의 정치 포럼이 만들어지고 왕성한 활동을 보였다. 이 때 리아드 세이프, 하이트함 알말레흐, 카말 알라브와니, 리야드 알투르크, 아레프 달리아와 같은 다양한 정치운동가가 이 운동을 이끌었다. 이 당시 가장 유명했던 포럼으로는 리아드 세이프 포럼, 자말 알아타시 포럼이 있다. 다마스쿠스의 봄은 2001년 8월 민주 선거를 요구하고 시민 불복종 운동을 지휘했던 운동가 10명이 체포되면서 끝나게 되었다. 2001년 이후 의회 내 개혁론자들은 전 대통령이었던 하페즈 알아사드의 통치 이후 이어진 경제 침체에 대해 비판했다. 바샤르 알아사드는 개혁에 대해 말은 하고 있으나 실제로는 거의 진행하고 있지 않으며, 2000년대 약속했던 개혁을 거의 하고 있지 않다. \n 질문: 2000년 7월 부터 2001년 8월 사이 시리아에서 사회적, 정치적 활동이 왕성한 시기를 부르는 말은?' -n 30

./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 김완선의 백밴드 실루엣의 활동이 거의 끝나갈 쯤 윤상은 당시 가수 김민우의 매니저였던 김광수(현 코어콘텐츠미디어 대표)로부터 솔로 가수 데뷔 제안을 받았다. 윤상은 이전에 김민우의 앨범 작업에 참여하여 데모 테이프를 만들어 준 적이 있었는데 여기에 가이드 보컬로 녹음한 윤상의 목소리를 김광수가 우연히 듣고 그에게 관심을 보인 것이었다. 그리하여 1990년 윤상은 신스팝과 마이너적인 진행을 같이 선보인 첫 정규 앨범《1집》을 발매했고 90만 장에 가까운 판매고를 올리며 성공적으로 데뷔했다. 타이틀곡인 〈이별의 그늘〉이 큰 인기를 얻었는데, 이 곡은 2008년에 가수 이승기가 그의 비정규 앨범《남자가 여자를 사랑할 때 Vol. 2》에서 <추억 속의 그대>와 함께 리메이크하여 수록하기도 했다. 작곡가였던 윤상이 솔로 데뷔를 결심하게 된 가장 큰 계기는 사실 경제적인 이유 때문이었다. 당시 윤상이 구입을 원했던 신시사이저가 800만 원이었는데 때마침 소속사는 솔로 음반 한 장 계약에 무려 3천만 원을 제시했다. 윤상은 계약금으로 악기와 미디(MIDI:Music Instrument Digital Interface) 장비를 구입해 홈 스튜디오를 꾸몄다고 한다.[2] 2집은 그가 학창 시절 몸 담았던 밴드 ‘페이퍼모드’를 재결성하여 제작되었는데, 멤버는 드러머 김학인, 보컬 노성원, 베이시스트 김범수(현재 아스트로 비츠 프로듀서)로 구성되었다. 2집은 더블 앨범으로《PART 1》과《PART 2》가 1년의 시차를 두고 따로 발매되었는데, 《PART 1》은 대중적인 곡으로 구성되어 100만장 이상의 높은 판매고를 기록했으며, 타이틀 곡인 <가려진 시간 사이로>가 크게 히트했다. 《PART 2》는 전위적인 구성으로 비평가들에게 찬사를 받았지만 실험적인 성격이 너무 강한 나머지 30만 장 판매에 그쳤고, 이후 윤상은 상업적인 노선과 조금씩 거리를 두게 되었다. 또한 군 입대 이전, 정규 앨범 외에도 1993년 9월에 방영한 드라마 MBC 《파일럿》의 OST 를 프로듀싱 했다. 1996년 1월 제대한 후 장기간의 공백을 깨고 비정규 음반 《Renacimiento》를 발표했다. 여기에서는 군 복무 이전에 선보인 자신의 곡들을 재편곡하고 미국, 이태리, 프랑스 출신의 객원 보컬을 섭외하여 그 나라의 언어로 개사하여 부른 버전을 수록했다. 같은 해에는 동갑내기 이자 동료 음악가인 ‘N.EX.T’의 리더 신해철과 함께 1992년부터 얘기가 오고 갔던 합동 음악작업이 이루어졌고, ‘노땐스(No Dance)’라는 이름으로 프로젝트 팀을 결성하여 1996년 가을에 앨범《골든힛트》를 발매했다. 두 사람은 테크노 음악으로 만든 여러 형태의 곡을 선보였는데, 테크노 음악이 1990년대 당시 국내 가요시장에서 댄스음악의 대량복제에 쓰여온 왜곡된 현실을 바로잡고, 테크노 음악으로도 얼마든지 실험적인 음악을 할 수 있다는 것을 보여주기 위해 이 작업을 했다고 밝혔다. 이 앨범의 실린 곡 중 신해철이 만든 〈월광〉은 1998년 발매된 《Crom`s Techno Works》앨범에서 편곡되었고, 〈달리기〉는 S.E.S.의 2002년 발매작 《Choose My Life-U》에서, 〈질주〉는 아스트로 비츠가 2008년에 발매된 윤상의 헌정앨범 성격인 《YOONSANG SONGBOOK：Play With Him!》에서 각각 리메이크했다. 1997년 발매한 Insensible에서는 《Renacimiento》에서 보인 월드 음악적인 성향과 신스팝 형태의 곡을 선보였다. \n 질문: 김완선의 백밴드 활동이 끝나갈 쯤 윤상에게 솔로 가수 데뷔를 제안한 인물은?' -n 30

./build/bin/llama-cli -m llama-3.2-1B-Instruct.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 1865년(고종 2년) 9월 대비 조씨의 건의로 다시 공신 칭호를 돌려받았다. 1865년 고종은 경복궁을 중건하고 그 설계자인 정도전의 공을 인정해 그의 관작을 회복시켜 주었으며 문헌(文憲)이라는 시호를 내렸다. 그 뒤 고종은 후손들이 사는 경기 양성현(안성군 공도면, 평택시 진위면)에 사당을 건립하였다. 고종은 정도전의 조선 건국과 제도와 법령 마련, 체제 정비 등의 치적을 기려 유종공종(儒宗功宗) 현판을 특필하여 하사하였다. 사당은 1986년 4월 경기도유형문화재 132호로 지정되었다. 불천지위(不遷之位)에 추대되었고, 그의 묘소가 실전되어 1872년(고종 8년) 왕명에 의해 위패를 봉안하고 제사를 받들게 하였다. 1872년 개국공신으로 공식 복권되고 이듬해 관직과 작위가 회복되었다. 1873년(고종 10) 남인 인사들에 의해 이현일, 윤휴, 한효순, 목내선, 정인홍, 정도전 등을 복권해야 된다는 신원 상소가 올려졌다. 이에 면암 최익현과 중암 김평묵은 강하게 반발하였고 복권을 막기 위해 노력하였으나, 고종은 정도전 복권을 강행하였는데, 이는 정도전이 조선왕조건국에 끼친 공로를 추앙하여 복권을 한 것으로, 기존의 조선왕조에서 복권이 된 사람들인 김종서, 황보인, 이개, 성삼문 등 사육신, 남이의 옥사에 희생된 남이, 기묘사화 때 희생된 기묘명헌의 사람 중 한 사람인 정암 조광조 등의 경우와 다른 점이다. \n 질문: 고종이 경복궁을 중건하고 설계를 했던 정도전의 관직을 회복시켜 준 해는?' -n 30



[Metric 점수 확인을 위한 기존 validation 데이터 형식 변경 및 점수 확인하기]
cd ..
# 데이터 형식 변경
python KorQuAD_flattened.py --infile ./KorQuAD_v1.0/korquad_validation.json --outfile ./KorQuAD_v1.0/korquad_val_flatten.json
# fine-tuning 전 모델
python KorQuAD_evaluate-v1.0.py ./KorQuAD_v1.0/korquad_val_flatten.json ./preds_base.json
# fine-tuning 후 모델
python KorQuAD_evaluate-v1.0.py ./KorQuAD_v1.0/korquad_val_flatten.json ./preds_lora.json
# 예시 답변 10개 확인하기
python read_pred_json.py



[학습을 진행한 모델을 llama.cpp로 inference해보기]
cd llama.cpp
# GGUF 형식으로 변환하기
python convert_hf_to_gguf.py ./../merged-1B-instruct-ko/ --outfile llama-3.2-1B-Instruct-lora.gguf --outtype f16
# 변환된 모델로 질문해보기
./build/bin/llama-cli -m llama-3.2-1B-Instruct-lora.gguf -p "llama.cpp는 뭐니?" -n 600

./build/bin/llama-cli -m llama-3.2-1B-Instruct-lora.gguf -p "How can I learn to code?" -n 600

./build/bin/llama-cli -m llama-3.2-1B-Instruct-lora.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 하페즈 알아사드의 후계자 문제는 1998년 시리아 인민 의회 선거 이후 폭력적인 시위와 무력 충돌을 일으키며 1999년 라타키아 시위로 발전하였다. 이 사건은 하페즈 알아사드와 그의 동생 리파트 알아사드 사이에 몇 년 간 축적된 불화가 폭발한 사건이었다. 시리아 경찰은 라타키아의 리파트 항만 시설에 대한 단속을 벌였고, 이 과정에서 경찰과 리파트 알아사드 지지자들과의 총격전이 벌어져 2명이 살해되었다. 정부 측은 부정하고 있으나, 이 사건의 사상자가 수백명에 달했다는 추측이 있다. 하페즈 알아사드는 간질성 폐질환으로 1년 뒤 사망했으며, 하페즈 알아사드의 아들인 바샤르 알아사드가 대통령이 될 수 있는 나이 규정인 40세를 당시 그의 나이인 34세로 인하하도록 헌법을 수정한 후, 후계자가 되었다. 그의 아버지인 하페즈 알아사드를 이어 대통령이 된 바샤르 알아사드와 영국에서 태어나 교육을 받은 수니파 무슬림인 그의 아내 아스마 알아사드는 초기에는 민주주의를 실현하고 국가를 개혁하겠다는 희망을 시리아에 불어넣었다. 이 영향으로 2000년 7월부터 2001년 8월 사이 다마스쿠스의 봄이라는 강렬한 사회적, 정치적 논쟁이 시작된다. 이 기간에는 같은 생각을 가진 사람들끼리 모여 정치적, 사회적 문제에 대해 의논하는 살롱과 같은 다수의 정치 포럼이 만들어지고 왕성한 활동을 보였다. 이 때 리아드 세이프, 하이트함 알말레흐, 카말 알라브와니, 리야드 알투르크, 아레프 달리아와 같은 다양한 정치운동가가 이 운동을 이끌었다. 이 당시 가장 유명했던 포럼으로는 리아드 세이프 포럼, 자말 알아타시 포럼이 있다. 다마스쿠스의 봄은 2001년 8월 민주 선거를 요구하고 시민 불복종 운동을 지휘했던 운동가 10명이 체포되면서 끝나게 되었다. 2001년 이후 의회 내 개혁론자들은 전 대통령이었던 하페즈 알아사드의 통치 이후 이어진 경제 침체에 대해 비판했다. 바샤르 알아사드는 개혁에 대해 말은 하고 있으나 실제로는 거의 진행하고 있지 않으며, 2000년대 약속했던 개혁을 거의 하고 있지 않다. \n 질문: 2000년 7월 부터 2001년 8월 사이 시리아에서 사회적, 정치적 활동이 왕성한 시기를 부르는 말은?' -n 30

./build/bin/llama-cli -m llama-3.2-1B-Instruct-lora.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 김완선의 백밴드 실루엣의 활동이 거의 끝나갈 쯤 윤상은 당시 가수 김민우의 매니저였던 김광수(현 코어콘텐츠미디어 대표)로부터 솔로 가수 데뷔 제안을 받았다. 윤상은 이전에 김민우의 앨범 작업에 참여하여 데모 테이프를 만들어 준 적이 있었는데 여기에 가이드 보컬로 녹음한 윤상의 목소리를 김광수가 우연히 듣고 그에게 관심을 보인 것이었다. 그리하여 1990년 윤상은 신스팝과 마이너적인 진행을 같이 선보인 첫 정규 앨범《1집》을 발매했고 90만 장에 가까운 판매고를 올리며 성공적으로 데뷔했다. 타이틀곡인 〈이별의 그늘〉이 큰 인기를 얻었는데, 이 곡은 2008년에 가수 이승기가 그의 비정규 앨범《남자가 여자를 사랑할 때 Vol. 2》에서 <추억 속의 그대>와 함께 리메이크하여 수록하기도 했다. 작곡가였던 윤상이 솔로 데뷔를 결심하게 된 가장 큰 계기는 사실 경제적인 이유 때문이었다. 당시 윤상이 구입을 원했던 신시사이저가 800만 원이었는데 때마침 소속사는 솔로 음반 한 장 계약에 무려 3천만 원을 제시했다. 윤상은 계약금으로 악기와 미디(MIDI:Music Instrument Digital Interface) 장비를 구입해 홈 스튜디오를 꾸몄다고 한다.[2] 2집은 그가 학창 시절 몸 담았던 밴드 ‘페이퍼모드’를 재결성하여 제작되었는데, 멤버는 드러머 김학인, 보컬 노성원, 베이시스트 김범수(현재 아스트로 비츠 프로듀서)로 구성되었다. 2집은 더블 앨범으로《PART 1》과《PART 2》가 1년의 시차를 두고 따로 발매되었는데, 《PART 1》은 대중적인 곡으로 구성되어 100만장 이상의 높은 판매고를 기록했으며, 타이틀 곡인 <가려진 시간 사이로>가 크게 히트했다. 《PART 2》는 전위적인 구성으로 비평가들에게 찬사를 받았지만 실험적인 성격이 너무 강한 나머지 30만 장 판매에 그쳤고, 이후 윤상은 상업적인 노선과 조금씩 거리를 두게 되었다. 또한 군 입대 이전, 정규 앨범 외에도 1993년 9월에 방영한 드라마 MBC 《파일럿》의 OST 를 프로듀싱 했다. 1996년 1월 제대한 후 장기간의 공백을 깨고 비정규 음반 《Renacimiento》를 발표했다. 여기에서는 군 복무 이전에 선보인 자신의 곡들을 재편곡하고 미국, 이태리, 프랑스 출신의 객원 보컬을 섭외하여 그 나라의 언어로 개사하여 부른 버전을 수록했다. 같은 해에는 동갑내기 이자 동료 음악가인 ‘N.EX.T’의 리더 신해철과 함께 1992년부터 얘기가 오고 갔던 합동 음악작업이 이루어졌고, ‘노땐스(No Dance)’라는 이름으로 프로젝트 팀을 결성하여 1996년 가을에 앨범《골든힛트》를 발매했다. 두 사람은 테크노 음악으로 만든 여러 형태의 곡을 선보였는데, 테크노 음악이 1990년대 당시 국내 가요시장에서 댄스음악의 대량복제에 쓰여온 왜곡된 현실을 바로잡고, 테크노 음악으로도 얼마든지 실험적인 음악을 할 수 있다는 것을 보여주기 위해 이 작업을 했다고 밝혔다. 이 앨범의 실린 곡 중 신해철이 만든 〈월광〉은 1998년 발매된 《Crom`s Techno Works》앨범에서 편곡되었고, 〈달리기〉는 S.E.S.의 2002년 발매작 《Choose My Life-U》에서, 〈질주〉는 아스트로 비츠가 2008년에 발매된 윤상의 헌정앨범 성격인 《YOONSANG SONGBOOK：Play With Him!》에서 각각 리메이크했다. 1997년 발매한 Insensible에서는 《Renacimiento》에서 보인 월드 음악적인 성향과 신스팝 형태의 곡을 선보였다. \n 질문: 김완선의 백밴드 활동이 끝나갈 쯤 윤상에게 솔로 가수 데뷔를 제안한 인물은?' -n 30

./build/bin/llama-cli -m llama-3.2-1B-Instruct-lora.gguf -p '다음 지문을 보고 질문의 정답만 한글로 출력하세요. \n 지문: 1865년(고종 2년) 9월 대비 조씨의 건의로 다시 공신 칭호를 돌려받았다. 1865년 고종은 경복궁을 중건하고 그 설계자인 정도전의 공을 인정해 그의 관작을 회복시켜 주었으며 문헌(文憲)이라는 시호를 내렸다. 그 뒤 고종은 후손들이 사는 경기 양성현(안성군 공도면, 평택시 진위면)에 사당을 건립하였다. 고종은 정도전의 조선 건국과 제도와 법령 마련, 체제 정비 등의 치적을 기려 유종공종(儒宗功宗) 현판을 특필하여 하사하였다. 사당은 1986년 4월 경기도유형문화재 132호로 지정되었다. 불천지위(不遷之位)에 추대되었고, 그의 묘소가 실전되어 1872년(고종 8년) 왕명에 의해 위패를 봉안하고 제사를 받들게 하였다. 1872년 개국공신으로 공식 복권되고 이듬해 관직과 작위가 회복되었다. 1873년(고종 10) 남인 인사들에 의해 이현일, 윤휴, 한효순, 목내선, 정인홍, 정도전 등을 복권해야 된다는 신원 상소가 올려졌다. 이에 면암 최익현과 중암 김평묵은 강하게 반발하였고 복권을 막기 위해 노력하였으나, 고종은 정도전 복권을 강행하였는데, 이는 정도전이 조선왕조건국에 끼친 공로를 추앙하여 복권을 한 것으로, 기존의 조선왕조에서 복권이 된 사람들인 김종서, 황보인, 이개, 성삼문 등 사육신, 남이의 옥사에 희생된 남이, 기묘사화 때 희생된 기묘명헌의 사람 중 한 사람인 정암 조광조 등의 경우와 다른 점이다. \n 질문: 고종이 경복궁을 중건하고 설계를 했던 정도전의 관직을 회복시켜 준 해는?' -n 30
